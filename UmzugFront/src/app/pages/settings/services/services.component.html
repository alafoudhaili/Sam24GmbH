<app-breadcrumbs title="Dienstverwaltungen" [breadcrumbItems]="breadCrumbItems"></app-breadcrumbs>
<div class="row">
    <div class="col-lg-12">
        <div class="card mb-4">
            <div class="card-header">
                <h4 class="card-title mb-0">Hinzufügen, Bearbeiten & Löschen</h4>
            </div>

            <div class="card-body p-3">
                <div id="customerList">
                    <div class="row g-2">
                        <div class="col-sm-4">
                            <button  class="btn btn-primary mb-3" (click)="openAddModal()">Neuen Dienst hinzufügen</button>
                        </div>
                        <div class="col-sm-4">
                        </div>
                        <div class="col-sm-4">
                            <div class="search-box">
                                <input type="text" class="form-control " [(ngModel)]="searchName"
                                       (input)="filterServices()" placeholder="Suchen...">
                                <i class="ri-search-line search-icon"></i>
                            </div>
                        </div>
                    </div>
                    <div *ngFor="let letter of alphabet" (click)="onLetterClick(letter)">
                    </div>
                    <br>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="table mt-3 mb-1">
                <div class="table-responsive">
                    <table class="table table-bordered table-sm">
                        <thead>
                        <tr class="bg-light text-muted">
                            <th class="small-text nowrap">TITEL</th>
                            <th class="small-text nowrap">BESCHREIBUNG</th>
                            <th class="actions-header small-text">AKTIONEN</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr *ngFor="let service of listServices">
                            <td class="small-text nowrap"><span>{{ service.titre }}</span></td>
                            <td class="small-text nowrap"><span [innerHTML]="service.description"></span></td>
                            <td class="small-text nowrap">
                                <a data-bs-toggle="modal" class="text-primary d-inline-block edit-item-btn"
                                   ngbTooltip="Bearbeiten" id="create-btn" data-bs-target="#showModal"
                                   style="cursor: pointer;"
                                   (click)="openModal(service, content)">
                                    <i class="ri-pencil-fill fs-16"></i>
                                </a>
                                <a class="text-danger d-inline-block remove-item-btn" data-bs-toggle="modal"
                                   ngbTooltip="Löschen" data-bs-target="#deleteOrder" style="cursor: pointer;"
                                   (click)="confirm(deleteModel, service.id_services)">
                                    <i class="ri-delete-bin-5-fill fs-16"></i>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="d-flex justify-content-end">
        <ngb-pagination
                [collectionSize]="length"
                [(page)]="currentPage"
                [pageSize]="itemsPerPage"
                [maxSize]="5"
                [rotate]="true"
                (pageChange)="pageChanged($event)"
        ></ngb-pagination>

    </div>
</div>

<!-- Modal für die Aktualisierung des Dienstes -->
<ng-template #content role="document" let-modal>
    <div class="modal-header bg-light p-3">
        <h5 class="modal-title" id="exampleModalLabel">Dienst aktualisieren</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="close-modal"
                (click)="modal.dismiss('Cross click')"></button>
    </div>
    <form (ngSubmit)="updateService()" [formGroup]="listForm" class="tablelist-form" autocomplete="off">
        <div class="modal-body">
            <input type="hidden" name="id_sponsor" value="" formControlName="id_services"/>
            <div class="mb-3" id="modal-id" style="display: none;">
                <label for="id-field" class="form-label">ID</label>
                <input type="text" id="id-field" class="form-control" placeholder="ID" readonly/>
            </div>
            <div class="mb-3">
                <label for="titre" class="form-label">Titel</label>
                <input type="text" id="titre" class="form-control"
                       placeholder="Titel" formControlName="titre"
                       [ngClass]="{ 'is-invalid': submitted && form['titre'].errors }"/>
            </div>
            <div class="col-12 mb-3 ckeditor-container">
                <label class="form-label">Beschreibung</label>
                <ckeditor formControlName="description" [editor]="editor" [config]="editorConfig"></ckeditor>
            </div>
        </div>
        <div class="modal-footer">
            <div class="hstack gap-2 justify-content-end">
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal"
                        (click)="modal.close('Close click')">Abbrechen
                </button>
                <button type="submit" class="btn btn-success" id="add-btn">Bestätigen</button>
            </div>
        </div>
    </form>
</ng-template>

<!-- Modal zum Löschen eines Dienstes -->
<ng-template #deleteModel let-modal>
    <div class="modal-content">
        <div class="modal-header">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="btn-close"
                    (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body">
            <div class="mt-2 text-center">
                <lord-icon src="https://cdn.lordicon.com/gsqxdxog.json" trigger="loop"
                           colors="primary:#405189,secondary:#f06548" style="width:90px;height:90px"></lord-icon>
                <div class="mt-4 pt-2 fs-15 mx-4 mx-sm-5">
                    <h4>Möchten Sie diesen Dienst wirklich löschen?</h4>
                    <p class="text-muted mx-4 mb-0">Diese Aktion löscht den Dienst endgültig.</p>
                </div>
            </div>
            <div class="d-flex gap-2 justify-content-center mt-4 mb-2">
                <button type="button" class="btn w-sm btn-success" ngbTooltip="Remove" data-bs-trigger="hover"
                        (click)="modal.close('Close click')">Abbrechen
                </button>
                <button type="button" class="btn w-sm btn-danger " id="delete-product"
                        (click)="deleteService()">Ja, ich lösche!
                </button>
            </div>

        </div>
    </div><!-- /.modal-content -->
</ng-template>

<!-- Modal zum Hinzufügen eines neuen Dienstes -->
<ng-template #addServiceModal let-modal>
    <div class="modal-header">
        <h5 class="modal-title">Neuen Dienst hinzufügen</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <form [formGroup]="addForm">
            <div class="mb-3">
                <label class="form-label">Titel</label>
                <input type="text"  class="form-control"
                       placeholder="Titel " required formControlName="titre"
                       [ngClass]="{ 'is-invalid': submitted && form['titre'].errors }"/>
            </div>
            <br>
            <div class="mb-6">
                <div class="col-12 mb-3 ckeditor-container">
                    <label class="form-label">Beschreibung</label>
                    <ckeditor formControlName="description" [editor]="editor" [config]="editorConfig"></ckeditor>
                </div>
            </div>
            <br>
        </form>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-danger" (click)="modal.dismiss('Cancel click')">Abbrechen</button>
        <button type="button" class="btn btn-success" (click)="saveService()">Speichern</button>

    </div>
</ng-template>
